<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <title>元元DIY邮箱生成器</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2196F3;
        }

        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            -webkit-box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 24px;
            margin: 0;
            font-weight: 600;
        }

        .control-group {
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-flex-wrap: wrap;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
        }

        .input-group {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            -ms-flex: 1;
            flex: 1;
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
            gap: 10px;
            min-width: 0;
        }

        .input-group label {
            font-size: 14px;
            white-space: nowrap;
            color: #555;
        }

        /* 输入框通用样式 */
        .input-group input {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px 12px;
            font-size: 14px;
            background: #fff;
            -webkit-box-flex: 1;
            -webkit-flex-grow: 1;
            -ms-flex-positive: 1;
            flex-grow: 1;
            min-width: 0;
            height: 40px;
            width: 100%;
        }

        /* 自定义spinner样式 */
        .input-with-spinners {
            position: relative;
            display: -webkit-inline-box;
            display: -webkit-inline-flex;
            display: -ms-inline-flexbox;
            display: inline-flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-box-flex: 1;
            -webkit-flex-grow: 1;
            -ms-flex-positive: 1;
            flex-grow: 1;
            min-width: 0;
        }

        .input-with-spinners input {
            padding-right: 30px;
            width: 100%;
        }

        .spinner-buttons {
            position: absolute;
            right: 1px;
            top: 1px;
            bottom: 1px;
            width: 24px;
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            -ms-flex-direction: column;
            flex-direction: column;
            background-color: #f8f8f8;
            border-left: 1px solid #ddd;
            border-radius: 0 5px 5px 0;
        }

        .spinner-btn {
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            -ms-flex-pack: center;
            justify-content: center;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
            height: 50%;
            padding: 0;
            border: none;
            background: none;
            font-size: 10px;
            color: #555;
            cursor: pointer;
        }

        .spinner-btn:active {
            background-color: #eee;
        }

        /* 数字输入框特殊样式 */
        .input-with-spinners input[type="number"] {
            -moz-appearance: textfield;
        }
        .input-with-spinners input[type="number"]::-webkit-outer-spin-button,
        .input-with-spinners input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* 按钮通用样式 */
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            height: 40px;
            display: -webkit-inline-box;
            display: -webkit-inline-flex;
            display: -ms-inline-flexbox;
            display: inline-flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            -ms-flex-pack: center;
            justify-content: center;
            white-space: nowrap;
            -webkit-tap-highlight-color: transparent;
            cursor: pointer;
        }

        .btn-reset {
            background-color: var(--primary-color);
            color: white;
            min-width: 60px;
        }

        .action-buttons {
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-flex-wrap: wrap;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn-main {
            background-color: var(--secondary-color);
            color: white;
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            -ms-flex: 1;
            flex: 1;
            min-width: calc(50% - 5px);
        }

        .selection-tools {
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-flex-wrap: wrap;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .range-input {
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
            gap: 8px;
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            -ms-flex: 1;
            flex: 1;
            min-width: 0;
        }

        .range-input input {
            -webkit-box-flex: 1;
            -webkit-flex-grow: 1;
            -ms-flex-positive: 1;
            flex-grow: 1;
            min-width: 0;
        }

        #output-container {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 10px;
            max-height: 50vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .email-item {
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: #f8f8f8;
            border-radius: 5px;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .checkbox {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            accent-color: var(--primary-color);
        }

        .email-info {
            -webkit-box-flex: 1;
            -webkit-flex-grow: 1;
            -ms-flex-positive: 1;
            flex-grow: 1;
            margin-right: 10px;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .copy-btn {
            background-color: var(--primary-color);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 13px;
            min-width: 60px;
            border: none;
            cursor: pointer;
        }

        .selected {
            background-color: #e3f2fd;
        }

        .sort-buttons {
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-flex-wrap: wrap;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        /* 加载动画 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.7);
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            -ms-flex-pack: center;
            justify-content: center;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
            z-index: 1000;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top-color: var(--secondary-color);
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
        }

        @-webkit-keyframes spin {
            to { -webkit-transform: rotate(360deg); transform: rotate(360deg); }
        }

        @keyframes spin {
            to { -webkit-transform: rotate(360deg); transform: rotate(360deg); }
        }

        /* iOS输入框样式修复 */
        input, textarea {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border-radius: 0;
        }

        /* 响应式调整 */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 15px;
            }

            .control-group {
                -webkit-box-orient: vertical;
                -webkit-box-direction: normal;
                -webkit-flex-direction: column;
                -ms-flex-direction: column;
                flex-direction: column;
                gap: 12px;
            }

            .input-group {
                width: 100%;
            }

            .btn-main {
                min-width: 100%;
            }

            #output-container {
                max-height: 40vh;
            }
        }

        @media (max-width: 400px) {
            .header h1 {
                font-size: 20px;
            }

            .email-info {
                font-size: 13px;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>元元DIY邮箱生成器</h1>
        </div>

        <div class="control-group">
            <div class="input-group">
                <label for="dateSuffix">日期后缀</label>
                <div class="input-with-spinners">
                    <input type="text" id="dateSuffix" inputmode="numeric" pattern="[0-9]*" placeholder="MMDD">
                    <div class="spinner-buttons">
                        <button type="button" class="spinner-btn" onclick="adjustDateSuffix(1)" aria-label="增加一天">▲</button>
                        <button type="button" class="spinner-btn" onclick="adjustDateSuffix(-1)" aria-label="减少一天">▼</button>
                    </div>
                </div>
                <button class="btn btn-reset" onclick="resetDateSuffix()">恢复</button>
            </div>
            <div class="input-group">
                <label for="emailDomain">邮箱域名</label>
                <input type="text" id="emailDomain" value="@e.edu.kg">
                <button class="btn btn-reset" onclick="resetEmailDomain()">恢复</button>
            </div>
            <div class="input-group">
                <label for="emailCount">生成数量</label>
                <div class="input-with-spinners">
                    <input type="number" id="emailCount" value="100" min="1" max="576">
                    <div class="spinner-buttons">
                        <button type="button" class="spinner-btn" onclick="adjustEmailCount(1)" aria-label="增加数量">▲</button>
                        <button type="button" class="spinner-btn" onclick="adjustEmailCount(-1)" aria-label="减少数量">▼</button>
                    </div>
                </div>
                <button class="btn btn-reset" onclick="resetEmailCount()">恢复</button>
            </div>
        </div>

        <div class="action-buttons">
            <button class="btn btn-main" onclick="generateData()">生成数据</button>
            <button class="btn btn-main" onclick="copyAll()">复制全部</button>
            <button class="btn btn-main" onclick="exportTXT()">导出TXT</button>
        </div>

        <div class="selection-tools">
            <button class="btn btn-main" onclick="selectAll()">全选</button>
            <button class="btn btn-main" onclick="invertSelection()">反选</button>
            <button class="btn btn-main" onclick="copySelected()">复制选中</button>
            <div class="range-input">
                <input type="text" id="copyRange" placeholder="例: 001-005">
                <button class="btn btn-main" onclick="copyRange()">复制范围</button>
            </div>
        </div>

        <div class="sort-buttons">
            <button class="btn btn-main" onclick="sortData('asc')">顺序排序</button>
            <button class="btn btn-main" onclick="sortData('desc')">倒序排序</button>
            <button class="btn btn-main" onclick="sortData('random')">随机排序</button>
        </div>

        <div id="output-container"></div>
    </div>

<script>
// 邮箱前缀数组
const email_prefixes = [
    'aa','bb','cc','dd','ee','ff','gg','hh','ii','jj',
    'kk','mm','nn','pp','qq','rr','ss','tt','uu','vv',
    'ww','xx','yy','zz','ab','ac','ad','ae','af','ag',
    'ah','ai','aj','ak','am','an','ap','aq','ar','as',
    'at','au','av','aw','ax','ay','az','ba','bc','bd',
    'be','bf','bg','bh','bi','bj','bk','bm','bn','bp',
    'bq','br','bs','bt','bu','bv','bw','bx','by','bz',
    'ca','cb','cd','ce','cf','cg','ch','ci','cj','ck',
    'cm','cn','cp','cq','cr','cs','ct','cu','cv','cw',
    'cx','cy','cz','da','db','dc','de','df','dg','dh',
    'di','dj','dk','dm','dn','dp','dq','dr','ds','dt',
    'du','dv','dw','dx','dy','dz','ea','eb','ec','ed',
    'ef','eg','eh','ei','ej','ek','em','en','ep','eq',
    'er','es','et','eu','ev','ew','ex','ey','ez','fa',
    'fb','fc','fd','fe','fg','fh','fi','fj','fk','fm',
    'fn','fp','fq','fr','fs','ft','fu','fv','fw','fx',
    'fy','fz','ga','gb','gc','gd','ge','gf','gh','gi',
    'gj','gk','gm','gn','gp','gq','gr','gs','gt','gu',
    'gv','gw','gx','gy','gz','ha','hb','hc','hd','he',
    'hf','hg','hi','hj','hk','hm','hn','hp','hq','hr',
    'hs','ht','hu','hv','hw','hx','hy','hz','ia','ib',
    'ic','id','ie','if','ig','ih','ij','ik','im','in',
    'ip','iq','ir','is','it','iu','iv','iw','ix','iy',
    'iz','ja','jb','jc','jd','je','jf','jg','jh','ji',
    'jk','jm','jn','jp','jq','jr','js','jt','ju','jv',
    'jw','jx','jy','jz','ka','kb','kc','kd','ke','kf',
    'kg','kh','ki','kj','km','kn','kp','kq','kr','ks',
    'kt','ku','kv','kw','kx','ky','kz','ma','mb','mc',
    'md','me','mf','mg','mh','mi','mj','mk','mn','mp',
    'mq','mr','ms','mt','mu','mv','mw','mx','my','mz',
    'na','nb','nc','nd','ne','nf','ng','nh','ni','nj',
    'nk','nm','np','nq','nr','ns','nt','nu','nv','nw',
    'nx','ny','nz','pa','pb','pc','pd','pe','pf','pg',
    'ph','pi','pj','pk','pm','pn','pq','pr','ps','pt',
    'pu','pv','pw','px','py','pz','qa','qb','qc','qd',
    'qe','qf','qg','qh','qi','qj','qk','qm','qn','qp',
    'qr','qs','qt','qu','qv','qw','qx','qy','qz','ra',
    'rb','rc','rd','re','rf','rg','rh','ri','rj','rk',
    'rm','rn','rp','rq','rs','rt','ru','rv','rw','rx',
    'ry','rz','sa','sb','sc','sd','se','sf','sg','sh',
    'si','sj','sk','sm','sn','sp','sq','sr','st','su',
    'sv','sw','sx','sy','sz','ta','tb','tc','td','te',
    'tf','tg','th','ti','tj','tk','tm','tn','tp','tq',
    'tr','ts','tu','tv','tw','tx','ty','tz','ua','ub',
    'uc','ud','ue','uf','ug','uh','ui','uj','uk','um',
    'un','up','uq','ur','us','ut','uv','uw','ux','uy',
    'uz','va','vb','vc','vd','ve','vf','vg','vh','vi',
    'vj','vk','vm','vn','vp','vq','vr','vs','vt','vu',
    'vw','vx','vy','vz','wa','wb','wc','wd','we','wf',
    'wg','wh','wi','wj','wk','wm','wn','wp','wq','wr',
    'ws','wt','wu','wv','wx','wy','wz','xa','xb','xc',
    'xd','xe','xf','xg','xh','xi','xj','xk','xm','xn',
    'xp','xq','xr','xs','xt','xu','xv','xw','xy','xz',
    'ya','yb','yc','yd','ye','yf','yg','yh','yi','yj',
    'yk','ym','yn','yp','yq','yr','ys','yt','yu','yv',
    'yw','yx','yz','za','zb','zc','zd','ze','zf','zg',
    'zh','zi','zj','zk','zm','zn','zp','zq','zr','zs',
    'zt','zu','zv','zw','zx','zy'
];

// 获取当前日期MMDD格式
function getCurrentDate() {
    const d = new Date();
    return String(d.getMonth() + 1).padStart(2, '0') +
           String(d.getDate()).padStart(2, '0');
}

// 日期验证函数
function validateDate(month, day) {
    if (month < 1 || month > 12) return false;
    const date = new Date();
    date.setFullYear(2020, month - 1, 0); // 使用非闰年
    return day <= date.getDate();
}

// 调整日期后缀
function adjustDateSuffix(delta) {
    const input = document.getElementById('dateSuffix');
    let currentValue = input.value;
    
    // 如果为空或无效，设为当前日期
    if (!/^\d{4}$/.test(currentValue)) {
        resetDateSuffix();
        return;
    }

    const month = parseInt(currentValue.substring(0, 2), 10);
    const day = parseInt(currentValue.substring(2, 4), 10);
    
    // 验证日期有效性
    if (!validateDate(month, day)) {
        resetDateSuffix();
        return;
    }

    // 计算新日期
    const date = new Date();
    date.setMonth(month - 1);
    date.setDate(day);
    date.setDate(date.getDate() + delta);

    // 格式化新日期
    const newMonth = String(date.getMonth() + 1).padStart(2, '0');
    const newDay = String(date.getDate()).padStart(2, '0');
    input.value = newMonth + newDay;
}

// 调整生成数量
function adjustEmailCount(delta) {
    const input = document.getElementById('emailCount');
    let currentValue = parseInt(input.value, 10) || 100;
    let newValue = currentValue + delta;
    
    // 限制范围
    if (newValue < 1) newValue = 1;
    if (newValue > 576) newValue = 576;

    input.value = newValue;
}

// 生成随机密码
function generatePassword() {
    const allowedDigits = ['1','2','5','6','8','9'];
    return 'g' + Array.from({length:3}, 
         () => allowedDigits[Math.floor(Math.random()*6)]).join('') + '88';
}

// 显示加载状态
function showLoading() {
    const loader = document.createElement('div');
    loader.className = 'loading-overlay';
    loader.innerHTML = '<div class="spinner"></div>';
    document.body.appendChild(loader);
    return loader;
}

// 生成数据主函数
function generateData() {
    const loader = showLoading();
    
    // 使用setTimeout确保UI更新
    setTimeout(() => {
        try {
            const dateSuffixInput = document.getElementById('dateSuffix');
            const dateSuffix = dateSuffixInput.value;
            
            // 验证日期格式
            if (!/^\d{4}$/.test(dateSuffix)) {
                alert("日期后缀格式无效，应为MMDD（例如 0721）。请修正或点击'恢复'。");
                dateSuffixInput.focus();
                loader.remove();
                return;
            }

            const month = parseInt(dateSuffix.substring(0, 2), 10);
            const day = parseInt(dateSuffix.substring(2, 4), 10);
            
            if (!validateDate(month, day)) {
                alert(`日期后缀无效：${month}月没有${day}日。`);
                dateSuffixInput.focus();
                loader.remove();
                return;
            }

            const domainInput = document.getElementById('emailDomain');
            const domain = domainInput.value.trim();
            const emailCountInput = document.getElementById('emailCount');
            const count = parseInt(emailCountInput.value, 10);

            // 验证输入
            if (isNaN(count) || count < 1 || count > 576) {
                alert("生成数量必须是1到576之间的数字！");
                emailCountInput.focus();
                loader.remove();
                return;
            }
            
            if (!domain || !domain.startsWith("@")) {
                alert("邮箱域名不能为空且必须以@符号开头");
                domainInput.focus();
                loader.remove();
                return;
            }

            // 生成数据
            const container = document.getElementById('output-container');
            container.innerHTML = '';
            
            // 使用文档片段提高性能
            const fragment = document.createDocumentFragment();
            
            for (let index = 0; index < count; index++) {
                const prefix = email_prefixes[index % email_prefixes.length];
                const div = document.createElement('div');
                div.className = 'email-item';
                
                const emailText = `${prefix}${dateSuffix}${domain}`;
                const passwordText = generatePassword();
                
                div.innerHTML = `
                    <input type="checkbox" class="checkbox" onchange="toggleSelection(this)">
                    <div class="email-info" title="${emailText} ${passwordText}">
                        ${String(index+1).padStart(3,'0')}. ${emailText} ${passwordText}
                    </div>
                    <button class="copy-btn" onclick="copySingle(this)">复制</button>
                `;
                
                fragment.appendChild(div);
            }
            
            container.appendChild(fragment);
            
        } catch (error) {
            console.error("生成失败:", error);
            alert(`生成失败: ${error.message}`);
        } finally {
            loader.remove();
        }
    }, 50);
}

// 重置函数
function resetDateSuffix() {
     document.getElementById('dateSuffix').value = getCurrentDate(); 
}
function resetEmailDomain() {
     document.getElementById('emailDomain').value = '@e.edu.kg'; 
}
function resetEmailCount() {
     document.getElementById('emailCount').value = 100; 
}

// 初始化
document.addEventListener('DOMContentLoaded', () => {
    resetDateSuffix();
    
    // iOS输入框失焦后滚动复位
    document.body.addEventListener('focusout', () => {
        if (/iPhone|iPad/i.test(navigator.userAgent)) {
            setTimeout(() => window.scrollTo(0, 0), 100);
        }
    });
});

// 选择功能
function toggleSelection(checkbox) {
    checkbox.closest('.email-item').classList.toggle('selected', checkbox.checked);
}

function selectAll() {
    document.querySelectorAll('.email-item').forEach(item => {
        const checkbox = item.querySelector('.checkbox');
        checkbox.checked = true;
        item.classList.add('selected');
    });
}

function invertSelection() {
    document.querySelectorAll('.email-item').forEach(item => {
        const checkbox = item.querySelector('.checkbox');
        checkbox.checked = !checkbox.checked;
        item.classList.toggle('selected', checkbox.checked);
    });
}

// 获取项目文本
function getItemsText(selector) {
    return Array.from(document.querySelectorAll(selector))
        .map(div => {
            const text = div.textContent.trim();
            return text.replace(/^\d+\.\s+/, ''); // 移除序号
        })
        .filter(text => text);
}

// 复制功能
async function copyToClipboard(text, successMsg) {
    try {
        if (navigator.clipboard && window.isSecureContext) {
            await navigator.clipboard.writeText(text);
            showToast(successMsg);
        } else {
            // 兼容旧版浏览器
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                const copied = document.execCommand('copy');
                if (copied) {
                    showToast(successMsg);
                } else {
                    throw new Error('复制失败');
                }
            } finally {
                document.body.removeChild(textarea);
            }
        }
    } catch (err) {
        console.error('复制失败:', err);
        showToast('复制失败，请手动复制', true);
    }
}

// 显示操作提示
function showToast(message, isError = false) {
    const toast = document.createElement('div');
    toast.style.position = 'fixed';
    toast.style.bottom = '20px';
    toast.style.left = '50%';
    toast.style.transform = 'translateX(-50%)';
    toast.style.backgroundColor = isError ? '#f44336' : '#4CAF50';
    toast.style.color = 'white';
    toast.style.padding = '10px 20px';
    toast.style.borderRadius = '4px';
    toast.style.zIndex = '1000';
    toast.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
    toast.textContent = message;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => document.body.removeChild(toast), 300);
    }, 2000);
}

// 具体复制功能
function copySelected() {
    const selectedItemsText = getItemsText('.email-item.selected .email-info');
    
    if (selectedItemsText.length === 0) {
        showToast('请先选择要复制的条目', true);
        return;
    }

    copyToClipboard(selectedItemsText.join('\n'), `已复制 ${selectedItemsText.length} 条选中内容`);
}

function copyRange() {
    const rangeInput = document.getElementById('copyRange').value.trim();
    const rangeRegex = /^(\d+)\s*-\s*(\d+)$/;
    
    if (!rangeRegex.test(rangeInput)) {
        showToast('请输入正确范围格式（例: 1-5 或 001-005）', true);
        document.getElementById('copyRange').focus();
        return;
    }

    const match = rangeInput.match(rangeRegex);
    const start = parseInt(match[1], 10);
    const end = parseInt(match[2], 10);
    const allItems = document.querySelectorAll('.email-info');
    const totalItems = allItems.length;

    if (totalItems === 0) {
        showToast("请先生成数据，再复制范围", true);
        return;
    }

    if (start < 1 || end > totalItems || start > end) {
        showToast(`无效范围（请输入 1 到 ${totalItems} 之间）`, true);
        return;
    }

    const itemsToCopy = Array.from(allItems)
        .slice(start - 1, end)
        .map(div => div.textContent.replace(/^\d+\.\s+/, '').trim());
        
    if (itemsToCopy.length > 0) {
        copyToClipboard(itemsToCopy.join('\n'), `已复制 ${start}-${end} 范围内容`);
    }
}

function copySingle(button) {
    const text = button.previousElementSibling.textContent
        .replace(/^\d+\.\s+/, '').trim();
    copyToClipboard(text, '已复制单条内容');
}

function copyAll() {
    const itemsText = getItemsText('.email-info');
    
    if (itemsText.length === 0) {
        showToast("没有内容可以复制。请先生成数据。", true);
        return;
    }
    
    copyToClipboard(itemsText.join('\n'), `已复制全部 ${itemsText.length} 条内容`);
}

// 导出TXT
function exportTXT() {
    const itemsText = getItemsText('.email-info');
    
    if (itemsText.length === 0) {
        showToast("没有内容可以导出。请先生成数据。", true);
        return;
    }

    const blob = new Blob([itemsText.join('\r\n')], {type: 'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    
    const dateStr = new Date().toISOString().slice(0, 10).replace(/-/g, '');
    const domainPart = document.getElementById('emailDomain').value.replace('@','').split('.')[0];
    a.download = `邮箱列表_${domainPart}_${dateStr}_${itemsText.length}条.txt`;
    
    document.body.appendChild(a);
    a.click();
    
    setTimeout(() => {
        URL.revokeObjectURL(url);
        document.body.removeChild(a);
    }, 100);
}

// 排序功能
function sortData(type) {
    const container = document.getElementById('output-container');
    const items = Array.from(container.children);

    if (items.length === 0) return;

    switch (type) {
        case 'asc':
            items.sort((a, b) => {
                const aNum = parseInt(a.querySelector('.email-info').textContent);
                const bNum = parseInt(b.querySelector('.email-info').textContent);
                return aNum - bNum;
            });
            break;
            
        case 'desc':
            items.sort((a, b) => {
                const aNum = parseInt(a.querySelector('.email-info').textContent);
                const bNum = parseInt(b.querySelector('.email-info').textContent);
                return bNum - aNum;
            });
            break;
            
        case 'random':
            for (let i = items.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [items[i], items[j]] = [items[j], items[i]];
            }
            break;
    }

    container.innerHTML = '';
    items.forEach(item => container.appendChild(item));
}

// 触摸事件支持
document.querySelectorAll('[onclick]').forEach(el => {
    const handler = el.getAttribute('onclick');
    el.setAttribute('ontouchstart', handler);
});
</script>
</body>
</html>
