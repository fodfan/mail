<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>元元DIY邮箱生成器</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2196F3;
        }

        /* Apply box-sizing globally for easier layout */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0; /* Remove default body margin */
            padding: 15px; /* Add padding to body instead of margin */
            background-color: #f5f5f5;
            min-width: 300px; /* Prevent extreme shrinking */
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px; /* Adjusted padding */
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 25px;
        }

        .control-group {
            display: flex;
            gap: 15px; /* Slightly reduced gap */
            margin-bottom: 20px; /* Adjusted margin */
            flex-wrap: wrap;
            align-items: center;
        }

        .input-group {
            flex: 1 1 300px; /* Allow grow/shrink, base width */
            display: flex;
            align-items: center;
            gap: 8px; /* Reduced gap */
            /* min-width: 250px; Removed min-width here */
        }

        .input-group label {
            flex-shrink: 0; /* Prevent label from shrinking */
            white-space: nowrap;
            color: #333; /* Ensure label text is visible */
        }

        .input-group input {
            padding: 8px 10px; /* Adjusted padding */
            border: 1px solid #ccc; /* Slightly darker border */
            border-radius: 5px;
            flex: 1 1 auto; /* Allow input to grow AND shrink */
            min-width: 50px; /* Set a smaller min-width to allow shrinking */
        }

         .input-group .btn-reset {
             flex-shrink: 0; /* Prevent reset button from shrinking */
             padding: 8px 15px; /* Adjust padding if needed */
         }


        .btn {
            padding: 9px 18px; /* Adjusted padding slightly */
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            white-space: nowrap;
            font-size: 14px; /* Standardize font size */
        }
        .btn:hover {
             opacity: 0.9;
        }


        .btn-reset {
            background-color: var(--primary-color);
            color: white;
        }

        /* Button groups */
        .action-buttons,
        .selection-tools,
        .range-input-container, /* Added back for clarity, even if empty now */
        .sort-buttons {
            display: flex;
            flex-wrap: wrap; /* Allow wrapping */
            gap: 10px;
            margin-bottom: 15px;
            align-items: center; /* Align items vertically */
        }

        .action-buttons {
             margin-bottom: 20px;
        }


        .btn-main {
            background-color: var(--secondary-color);
            color: white;
            flex: 0 1 auto; /* Don't grow, Allow shrinking, Base on content */
        }

        /* --- Fix for Selection Tools Row --- */
        .selection-tools {
            /* display: flex, wrap, gap, align-items already set */
        }
        /* Style the individual buttons */
        .selection-tools > .btn-main {
             flex: 0 1 auto; /* Standard button behavior */
        }
        /* Style the range input group WITHIN selection-tools */
        .range-input {
            display: flex; /* Inner flex for input + button */
            align-items: center;
            gap: 5px;
            flex: 1 1 auto; /* Allow this GROUP to grow and shrink */
            min-width: 180px; /* Prevent extreme collapse */
        }
        .range-input input {
            flex: 1 1 auto; /* Input field takes space within the group */
            min-width: 80px; /* Prevent input becoming too small */
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .range-input .btn-main {
           flex: 0 0 auto; /* Button inside range doesn't grow/shrink */
           padding: 8px 15px; /* Match reset button padding */
        }
        /* --- End of Fix for Selection Tools Row --- */


        #output-container {
            border: 1px solid #ddd; /* Slightly softer border */
            border-radius: 8px;
            padding: 15px;
            max-height: 350px; /* Adjusted height */
            overflow-y: auto;
            margin-top: 5px;
            background-color: #fff; /* Ensure background */
        }

        .email-item {
            display: flex;
            align-items: center;
            padding: 10px 8px; /* Adjusted padding */
            margin: 4px 0; /* Adjusted margin */
            background: #f8f8f8;
            border-radius: 4px; /* Slightly smaller radius */
            border-bottom: 1px solid #eee; /* Subtle separator */
        }
         .email-item:last-child {
             border-bottom: none;
         }

        .checkbox {
            margin-right: 8px; /* Reduced margin */
            flex-shrink: 0;
            /* Add appearance reset for potentially better cross-browser consistency */
            appearance: none;
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border: 1px solid #ccc;
            border-radius: 3px;
            vertical-align: middle;
            position: relative; /* For positioning the checkmark */
        }
        .checkbox:checked {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        /* Simple checkmark using pseudo-element */
        .checkbox:checked::after {
            content: '';
            display: block;
            width: 4px;
            height: 8px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg) translate(-50%, -50%);
            position: absolute;
            left: 50%;
            top: 45%; /* Adjust fine positioning */
        }


        .email-info {
            flex: 1 1 auto; /* Allow shrink/grow */
            margin-right: 10px; /* Reduced margin */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 14px; /* Ensure consistent font size */
            color: #333;
        }

        .copy-btn {
            background-color: var(--primary-color);
            color: white;
            padding: 5px 10px; /* Smaller padding */
            border-radius: 3px;
            flex-shrink: 0;
            font-size: 12px; /* Smaller font */
        }

        .selected {
            background-color: #e3f2fd !important; /* Ensure override */
        }

        /* --- Mobile Styles Refined --- */
        @media (max-width: 480px) {
            body {
                padding: 10px; /* Less padding on small screens */
            }
            .container {
                padding: 15px;
            }
            .control-group {
                gap: 10px; /* Further reduce gap */
                margin-bottom: 15px;
                /* Items stack implicitly via flex-wrap */
            }
             .input-group {
                 flex-basis: 100%; /* Make each input group take full width */
                 min-width: unset; /* Remove desktop min-width */
             }
            .input-group input {
                 min-width: 50px; /* Keep small min-width */
            }

            .btn {
                 padding: 8px 14px; /* Mobile padding */
                 font-size: 13px; /* Mobile font size */
            }

            /* Ensure buttons in groups take reasonable space */
            .action-buttons .btn-main,
            .selection-tools > .btn-main, /* Target direct button children ONLY */
            .sort-buttons .btn-main {
                 flex: 1 1 30%; /* Try to fit 3 across */
                 text-align: center;
            }

            /* Allow range input group to wrap and take full width if needed */
            .selection-tools .range-input {
                 flex: 1 1 100%; /* Take full width if it wraps or is only item */
                 min-width: unset; /* Remove min width */
            }

            .email-info {
                white-space: normal; /* Allow email text to wrap */
            }
        }
        /* --- End of Mobile Styles --- */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>元元DIY邮箱生成器</h1>
        </div>

        <div class="control-group">
            <!-- Input Group 1 -->
            <div class="input-group">
                <label for="dateSuffix">日期后缀</label>
                <input type="text" id="dateSuffix">
                <button class="btn btn-reset" onclick="resetDateSuffix()">恢复</button>
            </div>
            <!-- Input Group 2 -->
            <div class="input-group">
                <label for="emailDomain">邮箱域名</label>
                <input type="text" id="emailDomain" value="@e.edu.kg">
                <button class="btn btn-reset" onclick="resetEmailDomain()">恢复</button>
            </div>
            <!-- Input Group 3 -->
            <div class="input-group">
                <label for="emailCount">生成数量</label>
                <input type="number" id="emailCount" value="100" min="1" max="576">
                <button class="btn btn-reset" onclick="resetEmailCount()">恢复</button>
            </div>
        </div>

        <!-- Group 1: Main Actions -->
        <div class="action-buttons">
            <button class="btn btn-main" onclick="generateData()">生成数据</button>
            <button class="btn btn-main" onclick="copyAll()">复制全部</button>
            <button class="btn btn-main" onclick="exportTXT()">导出TXT</button>
        </div>

        <!-- Group 2: Selection Tools (Includes Range Input) -->
        <div class="selection-tools">
            <button class="btn btn-main" onclick="selectAll()">全选</button>
            <button class="btn btn-main" onclick="invertSelection()">反选</button>
            <button class="btn btn-main" onclick="copySelected()">复制选中</button>
            <!-- Range Input Group -->
            <div class="range-input">
                <input type="text" id="copyRange" placeholder="例: 001-005">
                <button class="btn btn-main" onclick="copyRange()">复制范围</button>
            </div>
        </div>

        <!-- Group 3: Sort Buttons -->
        <div class="sort-buttons">
            <button class="btn btn-main" onclick="sortData('asc')">顺序排序</button>
            <button class="btn btn-main" onclick="sortData('desc')">倒序排序</button>
            <button class="btn btn-main" onclick="sortData('random')">随机排序</button>
        </div>

        <div id="output-container"></div>
    </div>

<script>
// Javascript constants and utility functions (no changes)
const email_prefixes = [
'aa','bb','cc','dd','ee','ff','gg','hh','ii','jj',
'kk','mm','nn','pp','qq','rr','ss','tt','uu','vv',
'ww','xx','yy','zz','ab','ac','ad','ae','af','ag',
'ah','ai','aj','ak','am','an','ap','aq','ar','as',
'at','au','av','aw','ax','ay','az','ba','bc','bd',
'be','bf','bg','bh','bi','bj','bk','bm','bn','bp',
'bq','br','bs','bt','bu','bv','bw','bx','by','bz',
'ca','cb','cd','ce','cf','cg','ch','ci','cj','ck',
'cm','cn','cp','cq','cr','cs','ct','cu','cv','cw',
'cx','cy','cz','da','db','dc','de','df','dg','dh',
'di','dj','dk','dm','dn','dp','dq','dr','ds','dt',
'du','dv','dw','dx','dy','dz','ea','eb','ec','ed',
'ef','eg','eh','ei','ej','ek','em','en','ep','eq',
'er','es','et','eu','ev','ew','ex','ey','ez','fa',
'fb','fc','fd','fe','fg','fh','fi','fj','fk','fm',
'fn','fp','fq','fr','fs','ft','fu','fv','fw','fx',
'fy','fz','ga','gb','gc','gd','ge','gf','gh','gi',
'gj','gk','gm','gn','gp','gq','gr','gs','gt','gu',
'gv','gw','gx','gy','gz','ha','hb','hc','hd','he',
'hf','hg','hi','hj','hk','hm','hn','hp','hq','hr',
'hs','ht','hu','hv','hw','hx','hy','hz','ia','ib',
'ic','id','ie','if','ig','ih','ij','ik','im','in',
'ip','iq','ir','is','it','iu','iv','iw','ix','iy',
'iz','ja','jb','jc','jd','je','jf','jg','jh','ji',
'jk','jm','jn','jp','jq','jr','js','jt','ju','jv',
'jw','jx','jy','jz','ka','kb','kc','kd','ke','kf',
'kg','kh','ki','kj','km','kn','kp','kq','kr','ks',
'kt','ku','kv','kw','kx','ky','kz','ma','mb','mc',
'md','me','mf','mg','mh','mi','mj','mk','mn','mp',
'mq','mr','ms','mt','mu','mv','mw','mx','my','mz',
'na','nb','nc','nd','ne','nf','ng','nh','ni','nj',
'nk','nm','np','nq','nr','ns','nt','nu','nv','nw',
'nx','ny','nz','pa','pb','pc','pd','pe','pf','pg',
'ph','pi','pj','pk','pm','pn','pq','pr','ps','pt',
'pu','pv','pw','px','py','pz','qa','qb','qc','qd',
'qe','qf','qg','qh','qi','qj','qk','qm','qn','qp',
'qr','qs','qt','qu','qv','qw','qx','qy','qz','ra',
'rb','rc','rd','re','rf','rg','rh','ri','rj','rk',
'rm','rn','rp','rq','rs','rt','ru','rv','rw','rx',
'ry','rz','sa','sb','sc','sd','se','sf','sg','sh',
'si','sj','sk','sm','sn','sp','sq','sr','st','su',
'sv','sw','sx','sy','sz','ta','tb','tc','td','te',
'tf','tg','th','ti','tj','tk','tm','tn','tp','tq',
'tr','ts','tu','tv','tw','tx','ty','tz','ua','ub',
'uc','ud','ue','uf','ug','uh','ui','uj','uk','um',
'un','up','uq','ur','us','ut','uv','uw','ux','uy',
'uz','va','vb','vc','vd','ve','vf','vg','vh','vi',
'vj','vk','vm','vn','vp','vq','vr','vs','vt','vu',
'vw','vx','vy','vz','wa','wb','wc','wd','we','wf',
'wg','wh','wi','wj','wk','wm','wn','wp','wq','wr',
'ws','wt','wu','wv','wx','wy','wz','xa','xb','xc',
'xd','xe','xf','xg','xh','xi','xj','xk','xm','xn',
'xp','xq','xr','xs','xt','xu','xv','xw','xy','xz',
'ya','yb','yc','yd','ye','yf','yg','yh','yi','yj',
'yk','ym','yn','yp','yq','yr','ys','yt','yu','yv',
'yw','yx','yz','za','zb','zc','zd','ze','zf','zg',
'zh','zi','zj','zk','zm','zn','zp','zq','zr','zs',
'zt','zu','zv','zw','zx','zy',
];

function getCurrentDate() {
    const d = new Date();
    // Ensure month and date are always two digits
    const month = String(d.getMonth() + 1).padStart(2, '0');
    const day = String(d.getDate()).padStart(2, '0');
    return month + day;
}

function generatePassword() {
    const allowedDigits = ['1','2','5','6','8','9'];
    return 'g' + Array.from({length:3},
         () => allowedDigits[Math.floor(Math.random()*6)]).join('') + '88';
}

// Main UI functions (generateData etc. - no changes)
function generateData() {
    try {
        const dateSuffix = document.getElementById('dateSuffix').value;
        const domain = document.getElementById('emailDomain').value;
        const inputCount = document.getElementById('emailCount').value;
        const count = parseInt(inputCount);

        if (isNaN(count) || count > 576 || count < 1) {
            alert("生成数量必须是1-576之间的数字！");
            return;
        }
        if (!domain || !domain.includes("@")) {
            alert("邮箱域名不能为空且必须包含@符号");
            return;
        }

        const container = document.getElementById('output-container');
        container.innerHTML = '';
        const fragment = document.createDocumentFragment();

        for (let i = 0; i < count; i++) {
            const prefix = email_prefixes[i % email_prefixes.length];
            const emailItem = document.createElement('div');
            emailItem.className = 'email-item';
            emailItem.innerHTML = `
                <input type="checkbox" class="checkbox" onchange="toggleSelection(this)">
                <div class="email-info">${String(i+1).padStart(3,'0')}. ${prefix}${dateSuffix}${domain} ${generatePassword()}</div>
                <button class="btn copy-btn" onclick="copySingle(this)">复制</button>
            `;
            fragment.appendChild(emailItem);
        }
        container.appendChild(fragment);

    } catch (error) {
        console.error("Generation Error:", error);
        alert(`生成失败: ${error.message}`);
    }
}

function resetDateSuffix() {
    try {
        const dateSuffixInput = document.getElementById('dateSuffix');
        if (dateSuffixInput) {
             dateSuffixInput.value = getCurrentDate();
        } else {
             console.error("Date suffix input not found");
        }
    } catch(e) {
        console.error("Error resetting date suffix:", e);
    }
}
function resetEmailDomain() { document.getElementById('emailDomain').value = '@e.edu.kg'; }
function resetEmailCount() { document.getElementById('emailCount').value = 100; }

// --- Fix for Date Suffix Initialization ---
// Use DOMContentLoaded, but add error handling
document.addEventListener('DOMContentLoaded', () => {
    console.log("DOM Loaded - attempting to set date suffix."); // Debugging
    resetDateSuffix(); // Call the guarded function
});
// Add a fallback call *after* the script, just in case DOMContentLoaded fails/is slow
// Note: This isn't ideal, but can help in problematic browsers.
// setTimeout(resetDateSuffix, 0); // Execute after current script block
// --- End of Fix ---


function toggleSelection(checkbox) {
    const item = checkbox.closest('.email-item');
    if (item) {
       item.classList.toggle('selected', checkbox.checked);
    }
}

function selectAll() {
    document.querySelectorAll('#output-container .checkbox').forEach(checkbox => {
        checkbox.checked = true;
        checkbox.dispatchEvent(new Event('change'));
    });
}

function invertSelection() {
    document.querySelectorAll('#output-container .checkbox').forEach(checkbox => {
        checkbox.checked = !checkbox.checked;
        checkbox.dispatchEvent(new Event('change'));
    });
}

// Copy/Export functions (no changes needed from previous version)
function copySelected() {
    const selectedItems = Array.from(document.querySelectorAll('#output-container .checkbox:checked'))
        .map(checkbox => {
            const infoDiv = checkbox.nextElementSibling;
            return infoDiv ? infoDiv.textContent.split('. ')[1] : '';
        })
        .filter(text => text);

    if (selectedItems.length === 0) {
        alert('请先选择要复制的条目！');
        return;
    }

    copyToClipboard(selectedItems.join('\n'), `已复制 ${selectedItems.length} 条选中内容`);
}

function copyRange() {
    const rangeInput = document.getElementById('copyRange').value.trim();
    if (!/^\d{1,3}-\d{1,3}$/.test(rangeInput)) {
        alert('请输入正确格式（例: 1-5 或 001-005）');
        return;
    }

    let [start, end] = rangeInput.split('-').map(Number);

     if (start < 1) start = 1;

    if (isNaN(start) || isNaN(end) || start < 1 || end > 576 || start > end) {
        alert('无效范围（起始和结束需在1-576之间，且起始不大于结束）');
        return;
    }

    const allItems = Array.from(document.querySelectorAll('#output-container .email-info'));
    if (allItems.length === 0) {
        alert('请先生成数据后再按范围复制。');
        return;
    }
    if (end > allItems.length) {
        alert(`范围结束值(${end})超出当前生成数量(${allItems.length})，将复制到最大可用值。`);
        end = allItems.length;
        if (start > end) {
             alert('调整后的范围无效 (起始大于结束)');
             return;
        }
    }


    const itemsToCopy = allItems
        .slice(start - 1, end)
        .map(div => div.textContent.split('. ')[1])
        .filter(text => text);

    if (itemsToCopy.length === 0) {
        alert('指定范围内没有可复制的内容。');
        return;
    }

    copyToClipboard(itemsToCopy.join('\n'), `已复制 ${start}-${end} 范围内容 (${itemsToCopy.length}条)`);
}

function copySingle(button) {
    const infoDiv = button.previousElementSibling;
    if (infoDiv) {
        const text = infoDiv.textContent.split('. ')[1];
        if (text) {
           copyToClipboard(text, '已复制: ' + text);
        } else {
           alert('无法提取要复制的内容。');
        }
    } else {
        alert('无法找到要复制的内容元素。');
    }
}

function copyAll() {
    const items = Array.from(document.querySelectorAll('#output-container .email-info'))
        .map(div => div.textContent.split('. ')[1])
        .filter(text => text);

    if (items.length === 0) {
        alert('没有内容可复制。');
        return;
    }
    copyToClipboard(items.join('\n'), `已复制全部 ${items.length} 条内容`);
}

function copyToClipboard(text, successMsg) {
    if (!text) return;

    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text)
            .then(() => {
                // Use a more subtle notification for copy, maybe?
                // Or keep alert for consistency.
                 alert(successMsg);
            })
            .catch(err => {
                console.error('Async Clipboard API failed:', err);
                fallbackCopyToClipboard(text, successMsg);
            });
    } else {
        fallbackCopyToClipboard(text, successMsg);
    }
}

function fallbackCopyToClipboard(text, successMsg) {
     const textarea = document.createElement('textarea');
     textarea.value = text;
     textarea.style.position = 'fixed';
     textarea.style.left = '-9999px';
     textarea.style.top = '0';
     textarea.setAttribute('readonly', '');
     document.body.appendChild(textarea);
     textarea.select();
     textarea.setSelectionRange(0, 99999);

     try {
         const successful = document.execCommand('copy');
         if (successful) {
            alert(successMsg);
         } else {
            throw new Error('execCommand returned false');
         }
     } catch (err) {
         console.error('Fallback copy failed:', err);
         alert('复制失败，您的浏览器可能不支持此操作。');
     } finally {
        if (document.body.contains(textarea)) {
            document.body.removeChild(textarea);
        }
     }
}


function exportTXT() {
    const items = Array.from(document.querySelectorAll('#output-container .email-info'))
        .map(div => div.textContent.split('. ')[1])
        .filter(text => text);

    if (items.length === 0) {
        alert('没有内容可导出。');
        return;
    }

    const textContent = items.join('\n');
    const blob = new Blob([textContent], {type: 'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');

    a.style.display = 'none';
    a.href = url;
    const dateStr = new Date().toISOString().slice(0, 10).replace(/-/g,'');
    a.download = `emails_${dateStr}.txt`;
    document.body.appendChild(a);

    try {
        a.click();
    } catch (e) {
        console.error("Error triggering download click:", e);
        alert("导出失败，浏览器可能阻止了自动下载。");
    }


    setTimeout(() => {
        if (document.body.contains(a)) {
             document.body.removeChild(a);
        }
        URL.revokeObjectURL(url);
    }, 100);
}


function sortData(type) {
    const container = document.getElementById('output-container');
    const emailItems = Array.from(container.children);

    if (emailItems.length === 0) return;

    let sortedItems;
    try {
        switch (type) {
            case 'asc':
                sortedItems = emailItems.sort((a, b) => {
                    const indexA = parseInt(a.querySelector('.email-info')?.textContent?.split('.')[0] || 0);
                    const indexB = parseInt(b.querySelector('.email-info')?.textContent?.split('.')[0] || 0);
                    return indexA - indexB;
                });
                break;
            case 'desc':
                sortedItems = emailItems.sort((a, b) => {
                    const indexA = parseInt(a.querySelector('.email-info')?.textContent?.split('.')[0] || 0);
                    const indexB = parseInt(b.querySelector('.email-info')?.textContent?.split('.')[0] || 0);
                    return indexB - indexA;
                });
                break;
            case 'random':
                for (let i = emailItems.length - 1; i > 0; i--) {
                     const j = Math.floor(Math.random() * (i + 1));
                     [emailItems[i], emailItems[j]] = [emailItems[j], emailItems[i]];
                }
                sortedItems = emailItems;
                break;
            default:
                return;
        }

        const fragment = document.createDocumentFragment();
        sortedItems.forEach(item => fragment.appendChild(item));
        container.innerHTML = '';
        container.appendChild(fragment);

    } catch (error) {
        console.error("Sorting Error:", error);
        alert(`排序失败: ${error.message}`);
    }
}
</script>
</body>
</html>
