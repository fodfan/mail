<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>元元DIY邮箱生成器</title>
    <style>
        :root {--primary-color: #4CAF50;--secondary-color: #2196F3;}
        * {-webkit-tap-highlight-color: transparent;box-sizing: border-box;}
        body {font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;margin: 0;padding: 20px;background-color: #f5f5f5;-webkit-text-size-adjust: 100%;-webkit-font-smoothing: antialiased;}
        .container {max-width: 800px;margin: 0 auto;background: white;padding: 20px;border-radius: 10px;box-shadow: 0 2px 10px rgba(0,0,0,0.1);}
        .header {text-align: center;color: var(--primary-color);margin-bottom: 20px;}
        .header h1 {font-size: 24px;margin: 0;font-weight: 600;}
        .control-group {display: flex;gap: 15px;margin-bottom: 20px;flex-wrap: wrap;align-items: center;}
        .input-group {flex: 1;display: flex;align-items: center;gap: 10px;min-width: 0;min-width: 200px;}
        .input-group label {font-size: 14px;white-space: nowrap;color: #555;}
        .input-group input {-webkit-appearance: none;appearance: none;border: 1px solid #ddd;border-radius: 6px;padding: 10px 12px;font-size: 14px;background: #fff;flex-grow: 1;min-width: 0;height: 40px;}
        .input-with-spinners {position: relative;display: inline-flex;align-items: center;flex-grow: 1;min-width: 0;}
        .input-with-spinners input {padding-right: 30px;width: 100%;}
        .spinner-buttons {position: absolute;right: 1px;top: 1px;bottom: 1px;width: 24px;display: flex;flex-direction: column;background-color: #f8f8f8;border-left: 1px solid #ddd;border-radius: 0 5px 5px 0;}
        .spinner-btn {display: flex;justify-content: center;align-items: center;height: 50%;padding: 0;border: none;background: none;font-size: 10px;color: #555;cursor: pointer;}
        .spinner-btn:active {background-color: #eee;}
        .input-with-spinners input[type="number"] {-moz-appearance: textfield;}
        .input-with-spinners input[type="number"]::-webkit-outer-spin-button,
        .input-with-spinners input[type="number"]::-webkit-inner-spin-button {-webkit-appearance: none;margin: 0;}
        .btn {padding: 10px 16px;border: none;border-radius: 6px;font-size: 14px;font-weight: 500;height: 40px;display: inline-flex;align-items: center;justify-content: center;white-space: nowrap;-webkit-tap-highlight-color: transparent;cursor: pointer;}
        .btn-reset {background-color: var(--primary-color);color: white;min-width: 60px;flex-shrink: 0;}
        .action-buttons,
        .selection-tools,
        .sort-buttons {display: flex;flex-wrap: wrap;gap: 12px;margin-bottom: 15px;}
        .btn-main {background-color: var(--secondary-color);color: white;flex: 1 1 auto;min-width: 0;}
        .selection-tools {align-items: center;}
        .range-input {display: flex;align-items: center;gap: 8px;flex: 1 1 auto;min-width: 180px;}
        .range-input input {-webkit-appearance: none;appearance: none;border: 1px solid #ddd;border-radius: 6px;padding: 10px 12px;font-size: 14px;background: #fff;height: 40px;flex-grow: 1;min-width: 80px;}
        .range-input button {flex-shrink: 0;}
        #output-container {border: 1px solid #eee;border-radius: 8px;padding: 10px;max-height: 50vh;overflow-y: auto;-webkit-overflow-scrolling: touch;}
        .email-item {display: flex;align-items: center;padding: 10px;margin: 5px 0;background: #f8f8f8;border-radius: 5px;-webkit-user-select: none;user-select: none;}
        .checkbox {margin-right: 10px;width: 18px;height: 18px;accent-color: var(--primary-color);flex-shrink: 0;}
        .email-info {flex-grow: 1;margin-right: 10px;font-size: 14px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;min-width: 0;}
        .copy-btn {background-color: var(--primary-color);color: white;padding: 6px 12px;border-radius: 4px;font-size: 13px;min-width: 60px;flex-shrink: 0;height: auto;}
        .selected {background-color: #e3f2fd;}
        .loading-overlay {position: fixed;top: 0;left: 0;right: 0;bottom: 0;background: rgba(255,255,255,0.7);display: flex;justify-content: center;align-items: center;z-index: 1000;}
        .spinner {width: 40px;height: 40px;border: 4px solid rgba(0,0,0,0.1);border-radius: 50%;border-top-color: var(--secondary-color);animation: spin 1s linear infinite;}
        @keyframes spin {to { transform: rotate(360deg); }}
        @media (max-width: 600px) {
            body {padding: 15px;}
            .container {padding: 15px;}
            .control-group {flex-direction: column;gap: 12px;}
            .input-group {width: 100%;min-width: 0;}
            .action-buttons .btn-main,
            .sort-buttons .btn-main {flex: 1 1 auto;min-width: 70px;}
            .selection-tools > .btn-main:nth-child(-n+3) {flex: 1 1 auto;min-width: 70px;}
            .selection-tools .range-input {flex: 1 1 auto;min-width: 180px;}
            #output-container {max-height: 45vh;}
        }
        @media (max-width: 400px) {
            body {padding: 10px;}
            .header h1 {font-size: 20px;}
            .email-info {font-size: 13px;}
            .action-buttons .btn-main,
            .sort-buttons .btn-main,
            .selection-tools > .btn-main:nth-child(-n+3) {min-width: 60px;}
            .selection-tools .range-input {min-width: 150px;}
            .btn {padding: 8px 12px;font-size: 13px;}
        }
        .manual-copy-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            z-index: 1001;
            max-width: 90%;
        }
        .manual-copy-textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            margin: 10px 0;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            font-family: monospace;
        }
        .manual-copy-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header"><h1>元元DIY邮箱生成器</h1></div>
        <div class="control-group">
            <div class="input-group">
                <label for="dateSuffix">日期后缀</label>
                <div class="input-with-spinners">
                    <input type="text" id="dateSuffix" inputmode="numeric" pattern="[0-9]*" placeholder="MMDD">
                    <div class="spinner-buttons">
                        <button type="button" class="spinner-btn" onclick="adjustDateSuffix(1)" aria-label="增加一天">▲</button>
                        <button type="button" class="spinner-btn" onclick="adjustDateSuffix(-1)" aria-label="减少一天">▼</button>
                    </div>
                </div>
                <button class="btn btn-reset" onclick="resetDateSuffix()">恢复</button>
            </div>
            <div class="input-group">
                <label for="emailDomain">邮箱域名</label>
                <input type="text" id="emailDomain" value="@e.edu.kg">
                <button class="btn btn-reset" onclick="resetEmailDomain()">恢复</button>
            </div>
            <div class="input-group">
                <label for="emailCount">生成数量</label>
                <div class="input-with-spinners">
                    <input type="number" id="emailCount" value="100" min="1" max="576">
                    <div class="spinner-buttons">
                        <button type="button" class="spinner-btn" onclick="adjustEmailCount(1)" aria-label="增加数量">▲</button>
                        <button type="button" class="spinner-btn" onclick="adjustEmailCount(-1)" aria-label="减少数量">▼</button>
                    </div>
                </div>
                <button class="btn btn-reset" onclick="resetEmailCount()">恢复</button>
            </div>
        </div>
        <div class="action-buttons">
            <button class="btn btn-main" onclick="generateData()">生成数据</button>
            <button class="btn btn-main" onclick="copyAll()">复制全部</button>
            <button class="btn btn-main" onclick="exportTXT()">导出TXT</button>
        </div>
        <div class="selection-tools">
            <button class="btn btn-main" onclick="selectAll()">全选</button>
            <button class="btn btn-main" onclick="invertSelection()">反选</button>
            <button class="btn btn-main" onclick="copySelected()">复制选中</button>
            <div class="range-input">
                <input type="text" id="copyRange" placeholder="例: 001-005">
                <button class="btn btn-main" onclick="copyRange()">复制范围</button>
            </div>
        </div>
        <div class="sort-buttons">
            <button class="btn btn-main" onclick="sortData('asc')">顺序排序</button>
            <button class="btn btn-main" onclick="sortData('desc')">倒序排序</button>
            <button class="btn btn-main" onclick="sortData('random')">随机排序</button>
        </div>
        <div id="output-container"></div>
    </div>

    <script>
        const email_prefixes = ['aa','bb','cc','dd','ee','ff','gg','hh','ii','jj','kk','mm','nn','pp','qq','rr','ss','tt','uu','vv','ww','xx','yy','zz','ab','ac','ad','ae','af','ag','ah','ai','aj','ak','am','an','ap','aq','ar','as','at','au','av','aw','ax','ay','az','ba','bc','bd','be','bf','bg','bh','bi','bj','bk','bm','bn','bp','bq','br','bs','bt','bu','bv','bw','bx','by','bz','ca','cb','cd','ce','cf','cg','ch','ci','cj','ck','cm','cn','cp','cq','cr','cs','ct','cu','cv','cw','cx','cy','cz','da','db','dc','de','df','dg','dh','di','dj','dk','dm','dn','dp','dq','dr','ds','dt','du','dv','dw','dx','dy','dz','ea','eb','ec','ed','ef','eg','eh','ei','ej','ek','em','en','ep','eq','er','es','et','eu','ev','ew','ex','ey','ez','fa','fb','fc','fd','fe','fg','fh','fi','fj','fk','fm','fn','fp','fq','fr','fs','ft','fu','fv','fw','fx','fy','fz','ga','gb','gc','gd','ge','gf','gh','gi','gj','gk','gm','gn','gp','gq','gr','gs','gt','gu','gv','gw','gx','gy','gz','ha','hb','hc','hd','he','hf','hg','hi','hj','hk','hm','hn','hp','hq','hr','hs','ht','hu','hv','hw','hx','hy','hz','ia','ib','ic','id','ie','if','ig','ih','ij','ik','im','in','ip','iq','ir','is','it','iu','iv','iw','ix','iy','iz','ja','jb','jc','jd','je','jf','jg','jh','ji','jk','jm','jn','jp','jq','jr','js','jt','ju','jv','jw','jx','jy','jz','ka','kb','kc','kd','ke','kf','kg','kh','ki','kj','km','kn','kp','kq','kr','ks','kt','ku','kv','kw','kx','ky','kz','ma','mb','mc','md','me','mf','mg','mh','mi','mj','mk','mn','mp','mq','mr','ms','mt','mu','mv','mw','mx','my','mz','na','nb','nc','nd','ne','nf','ng','nh','ni','nj','nk','nm','np','nq','nr','ns','nt','nu','nv','nw','nx','ny','nz','pa','pb','pc','pd','pe','pf','pg','ph','pi','pj','pk','pm','pn','pq','pr','ps','pt','pu','pv','pw','px','py','pz','qa','qb','qc','qd','qe','qf','qg','qh','qi','qj','qk','qm','qn','qp','qr','qs','qt','qu','qv','qw','qx','qy','qz','ra','rb','rc','rd','re','rf','rg','rh','ri','rj','rk','rm','rn','rp','rq','rs','rt','ru','rv','rw','rx','ry','rz','sa','sb','sc','sd','se','sf','sg','sh','si','sj','sk','sm','sn','sp','sq','sr','st','su','sv','sw','sx','sy','sz','ta','tb','tc','td','te','tf','tg','th','ti','tj','tk','tm','tn','tp','tq','tr','ts','tu','tv','tw','tx','ty','tz','ua','ub','uc','ud','ue','uf','ug','uh','ui','uj','uk','um','un','up','uq','ur','us','ut','uv','uw','ux','uy','uz','va','vb','vc','vd','ve','vf','vg','vh','vi','vj','vk','vm','vn','vp','vq','vr','vs','vt','vu','vw','vx','vy','vz','wa','wb','wc','wd','we','wf','wg','wh','wi','wj','wk','wm','wn','wp','wq','wr','ws','wt','wu','wv','wx','wy','wz','xa','xb','xc','xd','xe','xf','xg','xh','xi','xj','xk','xm','xn','xp','xq','xr','xs','xt','xu','xv','xw','xy','xz','ya','yb','yc','yd','ye','yf','yg','yh','yi','yj','yk','ym','yn','yp','yq','yr','ys','yt','yu','yv','yw','yx','yz','za','zb','zc','zd','ze','zf','zg','zh','zi','zj','zk','zm','zn','zp','zq','zr','zs','zt','zu','zv','zw','zx','zy'];

        function getCurrentDate() {
            const d = new Date();
            return String(d.getMonth() + 1).padStart(2, '0') + String(d.getDate()).padStart(2, '0');
        }

        function isValidDateMMDD(mmdd) {
            if (!/^\d{4}$/.test(mmdd)) return false;
            const month = parseInt(mmdd.substring(0, 2), 10);
            const day = parseInt(mmdd.substring(2, 4), 10);
            if (month < 1 || month > 12 || day < 1 || day > 31) return false;
            if ([4, 6, 9, 11].includes(month) && day > 30) return false;
            if (month === 2 && day > 29) return false;
            return true;
        }

        function adjustDateSuffix(delta) {
            const input = document.getElementById('dateSuffix');
            let currentValue = input.value;
            if (!isValidDateMMDD(currentValue)) {
                resetDateSuffix();
                currentValue = getCurrentDate();
            }
            const month = parseInt(currentValue.substring(0, 2), 10);
            const day = parseInt(currentValue.substring(2, 4), 10);
            const date = new Date(2023, month - 1, day);
            date.setDate(date.getDate() + delta);
            input.value = String(date.getMonth() + 1).padStart(2, '0') + String(date.getDate()).padStart(2, '0');
        }

        function adjustEmailCount(delta) {
            const input = document.getElementById('emailCount');
            let currentValue = parseInt(input.value, 10) || 100;
            input.value = Math.max(1, Math.min(currentValue + delta, 576));
        }

        function generatePassword() {
            const allowedDigits = ['1','2','5','6','8','9'];
            let password = 'g';
            for (let i = 0; i < 3; i++) password += allowedDigits[Math.floor(Math.random() * allowedDigits.length)];
            return password + '88';
        }

        function showLoading() {
            if (document.querySelector('.loading-overlay')) return;
            const loader = document.createElement('div');
            loader.className = 'loading-overlay';
            loader.innerHTML = '<div class="spinner"></div>';
            document.body.appendChild(loader);
            return loader;
        }

        function hideLoading(loader) {
            (loader || document.querySelector('.loading-overlay'))?.remove();
        }

        function generateData() {
            const loader = showLoading();
            setTimeout(() => {
                try {
                    const dateSuffix = document.getElementById('dateSuffix').value;
                    if (!isValidDateMMDD(dateSuffix)) {
                        alert("日期后缀格式无效，应为MMDD（例如 0721）。请修正或点击'恢复'。");
                        hideLoading(loader);
                        return;
                    }
                    const domain = document.getElementById('emailDomain').value.trim();
                    const count = parseInt(document.getElementById('emailCount').value, 10);
                    if (isNaN(count) || count < 1 || count > 576) {
                        alert("生成数量必须是1到576之间的数字！");
                        hideLoading(loader);
                        return;
                    }
                    if (!domain || !domain.startsWith("@")) {
                        alert("邮箱域名不能为空且必须以@符号开头");
                        hideLoading(loader);
                        return;
                    }
                    const container = document.getElementById('output-container');
                    container.innerHTML = '';
                    const fragment = document.createDocumentFragment();
                    for (let index = 0; index < count; index++) {
                        const prefix = email_prefixes[index % email_prefixes.length];
                        const div = document.createElement('div');
                        div.className = 'email-item';
                        const fullText = `${prefix}${dateSuffix}${domain} ${generatePassword()}`;
                        div.innerHTML = `
                            <input type="checkbox" class="checkbox" onchange="toggleSelection(this)">
                            <div class="email-info" title="${fullText}">${String(index + 1).padStart(3, '0')}. ${fullText}</div>
                            <button class="btn copy-btn" onclick="copySingle(this)">复制</button>
                        `;
                        div.dataset.fullText = fullText;
                        div.dataset.index = String(index + 1).padStart(3, '0');
                        fragment.appendChild(div);
                    }
                    container.appendChild(fragment);
                } catch (error) {
                    console.error("生成失败:", error);
                    alert(`生成失败: ${error.message}`);
                } finally {
                    hideLoading(loader);
                }
            }, 50);
        }

        function resetDateSuffix() { document.getElementById('dateSuffix').value = getCurrentDate(); }
        function resetEmailDomain() { document.getElementById('emailDomain').value = '@e.edu.kg'; }
        function resetEmailCount() { document.getElementById('emailCount').value = 100; }

        document.addEventListener('DOMContentLoaded', () => {
            resetDateSuffix();
            document.body.addEventListener('focusout', (event) => {
                if ((event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') && /iPhone|iPad|iPod/.test(navigator.userAgent)) {
                    setTimeout(() => window.scrollTo(0, 0), 100);
                }
            });
        });

        function toggleSelection(checkbox) {
            checkbox.closest('.email-item').classList.toggle('selected', checkbox.checked);
        }

        function selectAll() {
            const items = document.querySelectorAll('#output-container .email-item');
            items.forEach(item => {
                const checkbox = item.querySelector('.checkbox');
                if (!checkbox.checked) {
                    checkbox.checked = true;
                    item.classList.add('selected');
                }
            });
        }

        function invertSelection() {
            document.querySelectorAll('#output-container .email-item').forEach(item => {
                const checkbox = item.querySelector('.checkbox');
                checkbox.checked = !checkbox.checked;
                item.classList.toggle('selected', checkbox.checked);
            });
        }

        async function copyToClipboard(text, successMsg) {
            if (!text) return showToast('没有内容可复制', true);
            
            try {
                if (navigator.clipboard?.writeText) {
                    await navigator.clipboard.writeText(text);
                    return showToast(successMsg || '已复制到剪贴板');
                }

                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.readOnly = true;
                document.body.appendChild(textarea);
                
                const copyBox = document.createElement('div');
                copyBox.className = 'manual-copy-box';
                copyBox.innerHTML = `
                    <p style="margin:0 0 10px">请手动复制内容：</p>
                    <textarea class="manual-copy-textarea" readonly>${text}</textarea>
                    <div class="manual-copy-buttons">
                        <button class="btn btn-main" onclick="this.parentElement.parentElement.remove()">关闭</button>
                    </div>
                `;
                document.body.appendChild(copyBox);
                
                const copyTextarea = copyBox.querySelector('textarea');
                copyTextarea.select();
                showToast('已自动选中内容，请手动复制', false);

            } catch (err) {
                console.error('复制失败:', err);
                showToast('复制失败，请手动复制内容', true);
            }
        }

        function showToast(message, isError = false) {
            const toast = document.createElement('div');
            toast.style.cssText = `position:fixed;bottom:30px;left:50%;transform:translateX(-50%);background:${isError ? '#f44336' : '#4CAF50'};color:white;padding:12px 25px;border-radius:8px;z-index:1001;opacity:0;transition:opacity 0.3s;`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.style.opacity = '1', 10);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 2500);
        }

        function copySelected() {
            const selected = Array.from(document.querySelectorAll('.email-item.selected'))
                                .map(item => item.dataset.fullText)
                                .join('\n');
            copyToClipboard(selected || '', selected ? `已复制 ${selected.split('\n').length} 条选中内容` : '');
        }

        function copyRange() {
            const rangeInput = document.getElementById('copyRange').value.trim();
            const match = rangeInput.match(/^(\d+)\s*-\s*(\d+)$/);
            if (!match) return showToast('请输入正确范围格式（例: 1-5）', true);
            
            const start = parseInt(match[1], 10);
            const end = parseInt(match[2], 10);
            const items = document.querySelectorAll('#output-container .email-item');
            
            if (start < 1 || end > items.length || start > end) {
                return showToast(`无效范围（1-${items.length}）`, true);
            }
            
            const text = Array.from(items)
                            .slice(start - 1, end)
                            .map(item => item.dataset.fullText)
                            .join('\n');
            copyToClipboard(text, `已复制 ${start}-${end} 范围内容`);
        }

        function copySingle(button) {
            copyToClipboard(button.closest('.email-item').dataset.fullText, '已复制单条内容');
        }

        function copyAll() {
            const items = Array.from(document.querySelectorAll('#output-container .email-item'))
                             .map(item => item.dataset.fullText)
                             .join('\n');
            copyToClipboard(items, items ? `已复制全部 ${items.split('\n').length} 条内容` : '');
        }

        function exportTXT() {
            const text = Array.from(document.querySelectorAll('#output-container .email-item'))
                            .map(item => item.dataset.fullText)
                            .join('\r\n');
            if (!text) return showToast("没有内容可以导出", true);
            
            const blob = new Blob([text], {type: 'text/plain'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `邮箱列表_${new Date().toISOString().slice(0,10)}.txt`;
            a.click();
            setTimeout(() => URL.revokeObjectURL(url), 100);
        }

        function sortData(type) {
            const container = document.getElementById('output-container');
            const items = Array.from(container.children);
            if (items.length === 0) return showToast('没有内容可以排序', true);
            
            if (type === 'random') {
                for (let i = items.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [items[i], items[j]] = [items[j], items[i]];
                }
            } else {
                items.sort((a, b) => type === 'asc' ? 
                    parseInt(a.dataset.index) - parseInt(b.dataset.index) : 
                    parseInt(b.dataset.index) - parseInt(a.dataset.index));
            }
            container.innerHTML = '';
            container.append(...items);
            showToast(`已${type === 'random' ? '随机' : type === 'asc' ? '顺序' : '倒序'}排序`);
        }
    </script>
</body>
</html>
